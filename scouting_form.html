<!DOCTYPE html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        body {
            background-color: #000;
            color: #f0f0f0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        /* Form Inputs */
        input[type="text"],
        select,
        #yearRangeSelect {
            padding: 12px;
            font-size: 16px;
            border-radius: 6px;
            border: none;
            outline: none;
            margin: 10px 0;
            background-color: rgba(255, 255, 255, 0.08);
            color: #ffffff;
            width: 100%;
            max-width: 300px;
            box-sizing: border-box;
            transition: background-color 0.2s ease;
        }

        input[type="text"]:focus,
        select:focus {
            background-color: rgba(255, 255, 255, 0.15);
        }

        /* Buttons */
        button {
            padding: 12px 20px;
            font-size: 16px;
            background-color: #3e5ce4;
            color: white;
            border: none;
            border-radius: 6px;
            margin: 10px 5px 20px 0;
            cursor: pointer;
            transition: background-color 0.3s ease;
            width: 100%;
            max-width: 300px;
        }

        button:hover {
            background-color: #2b44af;
        }

        /* Headers */
        h1 {
            color: #ffffff;
            border-bottom: 2px solid #444;
            padding-bottom: 5px;
            margin-top: 40px;
            font-size: 1.8em;
        }

        /* Layout */
        .modules-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        /* Module Cards */
        .module {
            background-color: rgba(20, 20, 100, 0.85);
            border-radius: 10px;
            padding: 16px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s ease, background-color 0.2s ease;
        }

        .module:hover {
            transform: scale(1.02);
            background-color: rgba(40, 40, 140, 0.9);
        }

        .module-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #fff;
        }

        /* Counter Display */
        .counter-display {
            font-size: 32px;
            margin: 10px 0;
            color: #ffdf6b;
        }

        /* Score Display */
        .score-display {
            font-size: 16px;
            margin-bottom: 5px;
            color: #a0d8ff;
        }

        /* Counter Buttons */
        .counter-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 8px;
        }

        .counter-btn {
            font-size: 24px;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            border: none;
            background-color: #5c7cfa;
            color: white;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }

        .counter-btn:hover {
            background-color: #4a6edb;
        }

        /* Radio / Switch Modules */
        .radio,
        .switch {
            text-align: left;
            font-size: 15px;
            padding: 10px;
        }

        .radio input[type="radio"],
        .switch input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }

        .radio label {
            display: block;
            margin-bottom: 6px;
            cursor: pointer;
        }

        .radio input[type="radio"]:checked + label {
            font-weight: bold;
            color: #ffe873;
        }

        .switch .slider {
            display: inline-block;
            font-size: 16px;
            color: #fff;
            margin-left: 8px;
        }

        /* Total Score Display */
        #total-score-display {
            font-size: 20px;
            font-weight: bold;
            color: #ffe873;
            margin-top: 20px;
        }

        /* Dropdown Styling */
        #yearRangeSelect {
            background-color: rgba(255, 255, 255, 0.15);
            color: #fff;
            padding: 10px;
            border-radius: 6px;
            border: none;
            margin-bottom: 10px;
        }

        /* Toggle Switch Styling */
        .switch {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
        }

        .switch input[type="checkbox"] {
            appearance: none;
            width: 50px;
            height: 26px;
            background: #888;
            border-radius: 15px;
            position: relative;
            outline: none;
            cursor: pointer;
        }

        .switch input[type="checkbox"]::before {
            content: "";
            position: absolute;
            width: 22px;
            height: 22px;
            top: 2px;
            left: 2px;
            background: #fff;
            border-radius: 50%;
            transition: transform 0.3s ease;
        }

        .switch input[type="checkbox"]:checked {
            background: #4caf50;
        }

        .switch input[type="checkbox"]:checked::before {
            transform: translateX(24px);
        }

        .switch .slider {
            font-size: 16px;
            color: #fff;
        }

        /* Pretty Radio Buttons */
        .radio input[type="radio"] {
            display: none;
        }

        .radio label {
            display: flex;
            align-items: center;
            font-size: 15px;
            margin-bottom: 8px;
            padding: 8px 12px;
            border-radius: 6px;
            border: 1px solid #888;
            background-color: rgba(255, 255, 255, 0.05);
            transition: all 0.2s ease;
            cursor: pointer;
            color: #f0f0f0;
            position: relative;
            padding-left: 36px;
        }

        .radio label::before {
            content: '';
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 2px solid #ccc;
            background-color: transparent;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .radio input[type="radio"]:checked + label::before {
            background-color: #ffe873;
            border-color: #ffe873;
        }

        .radio input[type="radio"]:checked + label {
            font-weight: bold;
            background-color: rgba(255, 232, 115, 0.1);
            border-color: #ffe873;
            color: #ffe873;
        }


        /* Responsive */
        @media (max-width: 600px) {
            body {
                padding: 15px;
            }

            .modules-container {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 1.5em;
            }

            button,
            input[type="text"],
            select {
                font-size: 18px;
                padding: 14px;
                width: 100%;
            }

            .counter-display {
                font-size: 28px;
            }

            .counter-btn {
                font-size: 22px;
                width: 52px;
                height: 52px;
            }

            .radio label {
                font-size: 16px;
            }

            .module-title {
                font-size: 17px;
            }
        }
    </style>
</head>

<html>

<body>
    <!-- SheetJS library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="./api_keys_encryption.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
        import { getDatabase, ref, set, child, get } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries


        function arraysEqual(arr1, arr2) {
            if (arr1.length !== arr2.length) {
                return false;
            }
            return arr1.every((value, index) => value == arr2[index]);
        }

        function getParams() {
            var idx = document.URL.indexOf('?');
            var params = new Array();
            if (idx != -1) {
                var pairs = document.URL.substring(idx + 1, document.URL.length).split('&');
                for (var i = 0; i < pairs.length; i++) {
                    var nameVal = pairs[i].split('=');
                    params[nameVal[0]] = nameVal[1];
                }
            }
            return params;
        }

        const params = getParams()



        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
            apiKey: "",

            authDomain: "everglowftcscoutingdatabase.firebaseapp.com",

            projectId: "everglowftcscoutingdatabase",

            storageBucket: "everglowftcscoutingdatabase.firebasestorage.app",

            messagingSenderId: "198175864321",

            appId: "1:198175864321:web:7288ae6a3d5f21ba2e3200",

            measurementId: "G-N22KCE322T",

            databaseURL: "https://everglowftcscoutingdatabase-default-rtdb.europe-west1.firebasedatabase.app"

        };

        // Initialize Firebase
        var app
        var database
        var ftcApiKey
        var ftcApiCountriesToEvents

        const sendButton = document.getElementById("sendButton");
        const downloadButton = document.getElementById("downloadScoutingDataButton");
        const yearRangeSelect = document.getElementById("yearRangeSelect");

        function populate_year_range_select() {
            const myRef = ref(database, "/")

            get(myRef).then(snapshot => {
                const allYears = snapshot.val()
                for (const yearIndex in Object.keys(allYears)) {
                    const currYearRange = Object.keys(allYears)[yearIndex]
                    const option = document.createElement("option")
                    option.value = currYearRange
                    option.textContent = currYearRange
                    yearRangeSelect.appendChild(option)
                }
            })
        }


        function get_year_range() {
            return "2025-2026"
        }

        function get_year() {
            return "2025"
        }

        function write_to_firebase() {
            var currISOString = new Date().toISOString()
            currISOString = currISOString.substring(0, currISOString.indexOf(".")).replace("T", " ")
            const myRef = ref(database, get_year_range() + '/' + document.getElementById("teamNameInput").value + '/' + currISOString);

            console.log(counters)


            set(myRef, {
                "autonomous": {
                    "classifiedArtifacts": counters.get("autonomous").get("Classified Artifacts").toString(),
                    "overflowArtifacts": counters.get("autonomous").get("Overflow Artifacts").toString(),
                    "depotArtifacts": "0",
                    "artifactsMatchingPattern": counters.get("autonomous").get("Artifacts Matching Pattern").toString(),
                    "didLeave": counters.get("autonomous").get("Did Leave").toString(),
                    "baseReturn": "None"
                },
                "opMode": {
                    "classifiedArtifacts": counters.get("opMode").get("Classified Artifacts").toString(),
                    "overflowArtifacts": counters.get("opMode").get("Overflow Artifacts").toString(),
                    "depotArtifacts": counters.get("opMode").get("Depot Artifacts").toString(),
                    "artifactsMatchingPattern": counters.get("opMode").get("Artifacts Matching Pattern").toString(),
                    "didLeave": "false",
                    "baseReturn": counters.get("opMode").get("Base Return").toString()
                }
            })


            counters = new Map([
                ["autonomous", new Map()],
                ["opMode", new Map()]
            ])
            totalScore = 0
            initializeModules()
            document.getElementById("teamNameInput").value = ""
        }

        function fetch_from_firebase(year_range) {
            const myRef = ref(database, "/");

            var resultArray = []


            const interperters = {
                "2024-2025": (snapshot) => {
                    resultArray = [["Team Name", "Date of Entry", "Autonomous Net Samples", "Autnomous Low Samples", "Autonomous High Samples", "Autonomous Low Specimens", "Autonmous High Specimens", "OpMode Net Samples", "OpMode Low Samples", "OpMode High Samples", "OpMode Low Specimens", "OpMode High Specimens", "OpMode Ascent"]];
                    if (snapshot.exists()) {
                        const allTeams = snapshot.val()
                        const allTeamsKeys = Object.keys(allTeams)
                        for (const teamIndex in allTeamsKeys) {
                            const team = allTeamsKeys[teamIndex]
                            const allTeamTimestamps = Object.keys(allTeams[team])
                            for (const timestampIndex in allTeamTimestamps) {
                                var timestamp = allTeamTimestamps[timestampIndex]
                                var autoValues = allTeams[team][timestamp]["autonomous"]
                                var opModeValues = allTeams[team][timestamp]["opMode"]
                                resultArray.push([team, timestamp, autoValues["netSamples"], autoValues["lowBasketSamples"], autoValues["highBasketSamples"], autoValues["lowSpecimens"], autoValues["highSpecimens"], opModeValues["netSamples"], opModeValues["lowBasketSamples"], opModeValues["highBasketSamples"], opModeValues["lowSpecimens"], opModeValues["highSpecimens"], opModeValues["ascentScore"]])
                            }
                        }
                    }
                    return resultArray
                },
                "2025-2026": (snapshot) => {
                    resultArray = [["Team Name", "Date of Entry", "Autonomous Classified Artifacts", "Autonomous Overflow Artifacts", "Autonomous Artifacts Matching Pattern", "Autonomous Did Leave", "Teleop Classified Artifacts", "Teleop Overflow Artifacts", "Teleop Depot Artifacts", "Teleop Artifacts Matching Pattern", "Teleop Base Return"]];
                    if (snapshot.exists()) {
                        const allTeams = snapshot.val()
                        const allTeamsKeys = Object.keys(allTeams)
                        for (const teamIndex in allTeamsKeys) {
                            const team = allTeamsKeys[teamIndex]
                            const allTeamTimestamps = Object.keys(allTeams[team])
                            for (const timestampIndex in allTeamTimestamps) {
                                var timestamp = allTeamTimestamps[timestampIndex]
                                var autoValues = allTeams[team][timestamp]["autonomous"]
                                var opModeValues = allTeams[team][timestamp]["opMode"]
                                resultArray.push([team, timestamp, autoValues["classifiedArtifacts"], autoValues["overflowArtifacts"], autoValues["artifactsMatchingPattern"], autoValues["didLeave"], opModeValues["classifiedArtifacts"], opModeValues["overflowArtifacts"], opModeValues["depotArtifacts"], opModeValues["artifactsMatchingPattern"], opModeValues["baseReturn"]])
                            }
                        }
                    }
                    return resultArray
                },
            }


            return get(child(myRef, year_range)).then(interperters[year_range])
        }

        // Main function - takes 2D array and downloads as Excel
        function downloadExcelFromArray(data, filename = 'data.xlsx') {
            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(data);

            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');

            // Generate and download Excel file
            XLSX.writeFile(wb, filename);
        }

        const firebaseEncryptedApiKey = "j7imVG6yXcamt9ZS6hYqQxdGZVXmg5C6zlaiOhAFqeujirnZo1itlbimeVcykIll2zgc1vAKiBQXcGM1Ia9wM4eEYJSdb9qGlRaQYWxNkSf6ds0="
        const ftcEventsEncryptedUsername = "38rT4f0F8NuWxnWuy+y5jVjl9DnhE5RGu2gBkJfiAHTqusg8voIoKtkF6IJsUdJAWCva/4k6aQzS"
        const ftcEventsEncryptedAuthorizationKey = "rPDfh3qS+lRYAYV3n1EypXEGfZiYWWTw58nDh7Yiw71MExyJjhMEYbtt0yxK1C4nlHrlMhNyQnf6lZkhK/I5+y3R7n2dZ0bnj4P0iGIJEdc="
        const passwordHash = [16, -21, -25, -78, -24, -118, -123, 106, 55, 4, 43, 80, -6, -43, 62, -18, -104, -64, 72, -16, -22, -60, -113, 63, 98, -66, -79, -46, 74, -86, 85, -16]


        async function validatePasswordAndCreateApiKeys(givenPassword) {
            if (arraysEqual(await SHA_256(givenPassword), passwordHash)) {
                if (app == null || database == null) {
                    firebaseConfig.apiKey = await decryptApiKey(givenPassword, firebaseEncryptedApiKey)
                    app = initializeApp(firebaseConfig)
                    database = getDatabase(app)
                }
                ftcApiKey = await getFtcEventsApiKey(givenPassword)
                ftcApiCountriesToEvents = await getCountryEventMapFromFtcApi()
                return true
            }
            else {
                alert("Bad Password!")
                location.href = "/index.html"
                return false
            }
        }

        function getPassword() {
            if ("password" in params) {
                return params["password"]
            }
            else {
                let inputtedPasswordHere = prompt("Please enter the password: ")
                if (inputtedPasswordHere != null && inputtedPasswordHere != "") {
                    return inputtedPasswordHere
                }
            }
        }

        async function getFtcEventsApiKey(givenPassword) {
            const ftcEventsUsername = await decryptApiKey(givenPassword, ftcEventsEncryptedUsername)
            const ftcEventsAuthorizationKey = await decryptApiKey(givenPassword, ftcEventsEncryptedAuthorizationKey)
            return btoa(ftcEventsUsername + ":" + ftcEventsAuthorizationKey)
        }

        async function getCountryEventMapFromFtcApi() {
            let outputMap = new Map()

            let url = `https://corsproxy.io/?${encodeURIComponent(`https://ftc-api.firstinspires.org/v2.0/${get_year()}/events`)}`;

            if (!ftcApiKey) {
                await validatePasswordAndCreateApiKeys(inputtedPassword)
            }

            let headers = {
                "Authorization": `Basic ${ftcApiKey}`,
                "accept": "application/json"
            }

            try {
                const response = await fetch(url, {
                    method: 'GET',
                    headers: headers
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                let eventsList = data["events"]
                let test = [1, 2, 3]
                for (let i = 0; i < eventsList.length; i++) {
                    if (!outputMap.has(eventsList[i]["country"])) {
                        outputMap.set(eventsList[i]["country"], [[eventsList[i]["code"], eventsList[i]["name"]]])
                    }
                    else {
                        outputMap.get(eventsList[i]["country"]).push([eventsList[i]["code"], eventsList[i]["name"]])
                    }
                }
                return outputMap
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
        
        const inputtedPassword = getPassword()

        if (await validatePasswordAndCreateApiKeys(inputtedPassword)) {
            populate_year_range_select()

            sendButton.addEventListener('click', async () => {
                if (await validatePasswordAndCreateApiKeys(inputtedPassword)) {
                    write_to_firebase()
                }
            })

            downloadButton.addEventListener('click', async () => {
                if (await validatePasswordAndCreateApiKeys(inputtedPassword)) {
                    var year_range = yearRangeSelect.value
                    fetch_from_firebase(year_range).then(data => {
                        downloadExcelFromArray(data, "scouting_data_" + year_range + ".xlsx")
                    })
                }
            })
        }


        initializeModules()
    </script>

    <script>
        let counters = new Map([
            ["autonomous", new Map()],
            ["opMode", new Map()]
        ])

        let autonomousCounterModules = ["Classified Artifacts", "Overflow Artifacts", "Artifacts Matching Pattern"]
        let opModeCounterModules = ["Classified Artifacts", "Overflow Artifacts", "Depot Artifacts", "Artifacts Matching Pattern"]

        const everythingScoreStringProcessor = function(score) {
            return `Score: ${score}p`
        }

        
        const classifiedArtifactsScoreCalculator = (count) => 3*count
        const overflowAndDepotArtifactsScoreCalculator = (count) => 1*count
        const artifactsMatchingPatternScoreCalculator = (count) => 2*count
        const didLeaveScoreCalculator = function(value) {
            if (value) {
                return 3
            }
            else {
                return 0
            }
        }
        const baseReturnScoreCalculator = function(value) {
            if (value == "None") {
                return 0
            }
            else if (value == "Partial") {
                return 5
            }
            else if (value == "Full" || value == "Bonus") {
                return 10
            }
            return 0
        }
        
        let calculators = new Map([
            ["autonomous", new Map([
                ["classified-artifacts", classifiedArtifactsScoreCalculator],
                ["overflow-artifacts", overflowAndDepotArtifactsScoreCalculator],
                ["artifacts-matching-pattern", artifactsMatchingPatternScoreCalculator],
                ["did-leave", didLeaveScoreCalculator],
            ])],
            ["opMode", new Map([
                ["classified-artifacts", classifiedArtifactsScoreCalculator],
                ["overflow-artifacts", overflowAndDepotArtifactsScoreCalculator],
                ["depot-artifacts", overflowAndDepotArtifactsScoreCalculator],
                ["artifacts-matching-pattern", artifactsMatchingPatternScoreCalculator],
                ["base-return", baseReturnScoreCalculator],
            ])]
        ])

        let baseReturnRadioButtons

        let didLeaveCheckbox

        var totalScoreDisplay = document.getElementById("total-score-display")
        const totalScoreStringProcessor = (score) => `Total Score: ${score}p`
        
        function initializeModules() {
            const autonomousModulesContainer = document.getElementById("autonomousModulesContainer")
            const opModeModulesContainer = document.getElementById("opModeModulesContainer")

            for (var opModeStat in opModeCounterModules) {
                counters.get("opMode").set(opModeCounterModules[opModeStat], 0)
            }
            for (var autonomousStat in autonomousCounterModules) {
                counters.get("autonomous").set(autonomousCounterModules[autonomousStat], 0)
            }
            counters.get("opMode").set("Base Return", "None")
            counters.get("autonomous").set("Did Leave", false)

            opModeModulesContainer.innerHTML = opModeCounterModules.map(title => `
                    <div class="module counter" id="counter-module-opMode-${sanitizeId(title)}">
                        <div class="module-title">${title}</div>
                        <div class="score-display" id="score-display-opMode-${(sanitizeId(title))}"">Score: 0p</div>
                        <div class="counter-display" id="counter-opMode-${sanitizeId(title)}">0</div>
                        <div class="counter-buttons">
                            <button class="counter-btn minus" onclick="updateCounter('opMode-${title}', -1, everythingScoreStringProcessor)">−</button>
                            <button class="counter-btn plus" onclick="updateCounter('opMode-${title}', 1, everythingScoreStringProcessor)">+</button>
                        </div>
                    </div>
                `).join("") + `
                    <div class="module radio" id="radio-module-opMode-base-return">
                        <div class="module-title">Base Return</div>
                        <input type="radio" name="opmode-base-return" value="None" id="none-return" checked>
                        <label for="none-return">None (0p)</label><br>

                        <input type="radio" name="opmode-base-return" value="Partial" id="partial-return">
                        <label for="partial-return">Partial (5p)</label><br>

                        <input type="radio" name="opmode-base-return" value="Full" id="full-return">
                        <label for="full-return">Full (10p)</label><br>

                        <input type="radio" name="opmode-base-return" value="Bonus" id="bonus-return">
                        <label for="bonus-return">Bonus (+10p)</label><br>
                    </div>
                `

            autonomousModulesContainer.innerHTML = autonomousCounterModules.map(title => `
                    <div class="module counter" id="counter-module-autonomous-${sanitizeId(title)}">
                        <div class="module-title">${title}</div>
                        <div class="score-display" id="score-display-autonomous-${(sanitizeId(title))}"">Score: 0p</div>
                        <div class="counter-display" id="counter-autonomous-${sanitizeId(title)}">0</div>
                        <div class="counter-buttons">
                            <button class="counter-btn minus" onclick="updateCounter('autonomous-${title}', -1, everythingScoreStringProcessor)">−</button>
                            <button class="counter-btn plus" onclick="updateCounter('autonomous-${title}', 1, everythingScoreStringProcessor)">+</button>
                        </div>
                    </div>
                `).join("") + `
                        <div class="module switch" id="switch-module-autonomous-did-leave">
                            <input type="checkbox" id="switch-autonomous-did-leave"/>
                            <span class="slider">Did Do Leave? (3p)</span>
                        </div>
                `

            baseReturnRadioButtons = document.querySelectorAll('input[name="opmode-base-return"]');
            baseReturnRadioButtons.forEach(
                radioButton => {
                    radioButton.addEventListener(
                        'change', 
                        function() {
                            if (this.checked) {
                                console.log(radioButton)
                                console.log(this.value)
                                counters.get("opMode").set("Base Return", this.value)
                                console.log(counters.get("opMode").get("Base Return"))
                                updateTotalScoreDisplay()
                            }
                        }
                    )
                }
            )

            didLeaveCheckbox = document.getElementById("switch-autonomous-did-leave")
            didLeaveCheckbox.addEventListener('change', function() {
                counters.get("autonomous").set("Did Leave", this.checked)
                updateTotalScoreDisplay()
            })

        }



        function updateTotalScoreDisplay() {
            let totalScore = 0

            counters.forEach(
                (innerMap, autonomousOrOpMode) => {
                    innerMap.forEach(
                        (value, key) => {
                            console.log(`autoOrOpMode: ${autonomousOrOpMode} | sanitizedId: ${sanitizeId(key)} | value: ${value}`)
                            console.log(`calculator: ${calculators.get(autonomousOrOpMode).get(sanitizeId(key))}`)
                            totalScore += calculators.get(autonomousOrOpMode).get(sanitizeId(key))(value)
                        }
                    )
                }
            );

            if (totalScoreDisplay == null) {
                totalScoreDisplay = document.getElementById("total-score-display")
            }

            totalScoreDisplay.textContent = totalScoreStringProcessor(totalScore)
        }

        function sanitizeId(title) {
            return title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
        }

        function updateCounter(nameToUpdate, change, scoreStringProcessor) {
            const prefix = nameToUpdate.substring(0, nameToUpdate.indexOf("-"))
            const title = nameToUpdate.substring(nameToUpdate.indexOf("-") + 1)
            const currentValue = counters.get(prefix).get(title) || 0;
            const newValue = Math.max(0, currentValue + change); // Prevent negative values
            counters.get(prefix).set(title, newValue);

            const counterElement = document.getElementById(`counter-${prefix}-${sanitizeId(title)}`)
            counterElement.textContent = newValue

            const scoreDisplayElement = document.getElementById(`score-display-${prefix}-${sanitizeId(title)}`)
            scoreDisplayElement.textContent = scoreStringProcessor(calculators.get(prefix).get(sanitizeId(title))(newValue))

            updateTotalScoreDisplay()
        }
    </script>


    <select id="yearRangeSelect"></select><br>
    <button id="downloadScoutingDataButton">Download Data</button><br><br>
    <label for="teamNameInput">Enter team name:</label>
    <button id="sendButton">Send Scouting</button><br>
    <input type="text" id="teamNameInput" name="teamNameInput">
    <p id="total-score-display">Total Score: 0p</p>
    <h1>Autonomous</h1><br>
    <div class="modules-container" id="autonomousModulesContainer"></div><br><br>
    <h1>OpMode</h1><br>
    <div class="modules-container" id="opModeModulesContainer"></div>
</body>

</html>