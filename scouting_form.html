<!DOCTYPE html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <link rel="icon" type="image/png" href="/images/favicon.png">
</head>

<html>

<body>
    <!-- SheetJS library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="./api_keys_encryption.js"></script>
    <script src="./common_stuff.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";
        import { getDatabase, ref, set, child, get } from "https://www.gstatic.com/firebasejs/12.0.0/firebase-database.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries


        function arraysEqual(arr1, arr2) {
            if (arr1.length !== arr2.length) {
                return false;
            }
            return arr1.every((value, index) => value == arr2[index]);
        }

        function getParams() {
            var idx = document.URL.indexOf('?');
            var params = new Array();
            if (idx != -1) {
                var pairs = document.URL.substring(idx + 1, document.URL.length).split('&');
                for (var i = 0; i < pairs.length; i++) {
                    var nameVal = pairs[i].split('=');
                    params[nameVal[0]] = nameVal[1];
                }
            }
            return params;
        }

        const params = getParams()



        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        var firebaseConfig = {
            apiKey: "",

            authDomain: "everglowftcscoutingdatabase.firebaseapp.com",

            projectId: "everglowftcscoutingdatabase",

            storageBucket: "everglowftcscoutingdatabase.firebasestorage.app",

            messagingSenderId: "198175864321",

            appId: "1:198175864321:web:7288ae6a3d5f21ba2e3200",

            measurementId: "G-N22KCE322T",

            databaseURL: "https://everglowftcscoutingdatabase-default-rtdb.europe-west1.firebasedatabase.app"

        };

        // Initialize Firebase
        var firebaseApp
        var database
        var ftcApiKey
        var ftcApiCountriesToEvents
        var currentEventsTeamsNamesList

        const sendButton = document.getElementById("sendButton");
        const downloadButton = document.getElementById("downloadScoutingDataButton");
        const yearRangeSelect = document.getElementById("yearRangeSelect");

        function populate_year_range_select() {
            const myRef = ref(database, "/")

            get(myRef).then(snapshot => {
                const allYears = snapshot.val()
                for (const yearIndex in Object.keys(allYears)) {
                    const currYearRange = Object.keys(allYears)[yearIndex]
                    const option = document.createElement("option")
                    option.value = currYearRange
                    option.textContent = currYearRange
                    yearRangeSelect.appendChild(option)
                }
            })
        }


        function sanitizeDatabaseInput(teamName) {
            const specialChars = {
                '.': `{${'.'.charCodeAt(0)}}`,
                '#': `{${'#'.charCodeAt(0)}}`,
                '$': `{${'$'.charCodeAt(0)}}`,
                '[': `{${'['.charCodeAt(0)}}`,
                ']': `{${']'.charCodeAt(0)}}`
            };

            return teamName.replace(/[.#$\[\]]/g, char => specialChars[char]);
        }

        function write_to_firebase() {
            let teamNameInputField = document.getElementById("teamNameInput");
            if (!currentEventsTeamsNamesList.includes(teamNameInputField.value)) {
                alert("Team does not exist!")
            }
            else if (document.getElementById("usernameInput").value == "") {
                alert("Must enter username!")
            }
            else {
                var currISOString = new Date().toISOString()
                currISOString = currISOString.substring(0, currISOString.indexOf(".")).replace("T", " ")
                const myRef = ref(database, get_year_range() + '/' + sanitizeDatabaseInput(teamNameInputField.value) + '/' + currISOString);
        
    
                set(myRef, {
                    "autonomous": {
                        "classifiedArtifacts": counters.get("autonomous").get("Classified Artifacts").toString(),
                        "overflowArtifacts": counters.get("autonomous").get("Overflow Artifacts").toString(),
                        "depotArtifacts": "0",
                        "artifactsMatchingPattern": counters.get("autonomous").get("Artifacts Matching Pattern").toString(),
                        "didLeave": counters.get("autonomous").get("Did Leave").toString(),
                        "baseReturn": "None"
                    },
                    "opMode": {
                        "classifiedArtifacts": counters.get("opMode").get("Classified Artifacts").toString(),
                        "overflowArtifacts": counters.get("opMode").get("Overflow Artifacts").toString(),
                        "depotArtifacts": counters.get("opMode").get("Depot Artifacts").toString(),
                        "artifactsMatchingPattern": counters.get("opMode").get("Artifacts Matching Pattern").toString(),
                        "didLeave": "false",
                        "baseReturn": counters.get("opMode").get("Base Return").toString()
                    },
                    "notes": sanitizeDatabaseInput(document.getElementById("notesInput").value),
                    "username": sanitizeDatabaseInput(document.getElementById("usernameInput").value)
                })
    
    
                counters = new Map([
                    ["autonomous", new Map()],
                    ["opMode", new Map()]
                ])
                initializeModules()
                updateTotalScoreDisplay()

                document.getElementById("notesInput").value = ""

                var scoutingDataSendSuccessIndicator = document.getElementById("scoutingDataSendSuccessIndicator")
                scoutingDataSendSuccessIndicator.hidden = false

                setTimeout(() => {
                    scoutingDataSendSuccessIndicator.hidden = true
                }, 2000)
            }
        }

        function fetch_from_firebase(year_range) {
            const myRef = ref(database, "/");

            var resultArray = []


            const interperters = {
                "2024-2025": (snapshot) => {
                    resultArray = [["Team Name", "Date of Entry", "Autonomous Net Samples", "Autnomous Low Samples", "Autonomous High Samples", "Autonomous Low Specimens", "Autonmous High Specimens", "OpMode Net Samples", "OpMode Low Samples", "OpMode High Samples", "OpMode Low Specimens", "OpMode High Specimens", "OpMode Ascent"]];
                    if (snapshot.exists()) {
                        const allTeams = snapshot.val()
                        const allTeamsKeys = Object.keys(allTeams)
                        for (const teamIndex in allTeamsKeys) {
                            const team = allTeamsKeys[teamIndex]
                            const allTeamTimestamps = Object.keys(allTeams[team])
                            for (const timestampIndex in allTeamTimestamps) {
                                var timestamp = allTeamTimestamps[timestampIndex]
                                var autoValues = allTeams[team][timestamp]["autonomous"]
                                var opModeValues = allTeams[team][timestamp]["opMode"]
                                resultArray.push([convertDatabaseInputToIntended(team), timestamp, autoValues["netSamples"], autoValues["lowBasketSamples"], autoValues["highBasketSamples"], autoValues["lowSpecimens"], autoValues["highSpecimens"], opModeValues["netSamples"], opModeValues["lowBasketSamples"], opModeValues["highBasketSamples"], opModeValues["lowSpecimens"], opModeValues["highSpecimens"], opModeValues["ascentScore"]])
                            }
                        }
                    }
                    return resultArray
                },
                "2025-2026": (snapshot) => {
                    resultArray = [["Team Name", "Date of Entry", "Username that entered", "Autonomous Classified Artifacts", "Autonomous Overflow Artifacts", "Autonomous Artifacts Matching Pattern", "Autonomous Did Leave", "Teleop Classified Artifacts", "Teleop Overflow Artifacts", "Teleop Depot Artifacts", "Teleop Artifacts Matching Pattern", "Teleop Base Return", "Notes On Match"]];
                    if (snapshot.exists()) {
                        const allTeams = snapshot.val()
                        const allTeamsKeys = Object.keys(allTeams)
                        for (const teamIndex in allTeamsKeys) {
                            const team = allTeamsKeys[teamIndex]
                            const allTeamTimestamps = Object.keys(allTeams[team])
                            for (const timestampIndex in allTeamTimestamps) {
                                var timestamp = allTeamTimestamps[timestampIndex]
                                var autoValues = allTeams[team][timestamp]["autonomous"]
                                var opModeValues = allTeams[team][timestamp]["opMode"]
                                resultArray.push([convertDatabaseInputToIntended(team), timestamp, convertDatabaseInputToIntended(allTeams[team][timestamp]["username"]), autoValues["classifiedArtifacts"], autoValues["overflowArtifacts"], autoValues["artifactsMatchingPattern"], autoValues["didLeave"], opModeValues["classifiedArtifacts"], opModeValues["overflowArtifacts"], opModeValues["depotArtifacts"], opModeValues["artifactsMatchingPattern"], opModeValues["baseReturn"], convertDatabaseInputToIntended(allTeams[team][timestamp]["notes"])])
                            }
                        }
                    }
                    return resultArray
                },
            }


            return get(child(myRef, year_range)).then(interperters[year_range])
        }

        // Main function - takes 2D array and downloads as Excel
        function downloadExcelFromArray(data, filename = 'data.xlsx') {
            // Create workbook and worksheet
            const wb = XLSX.utils.book_new();
            const ws = XLSX.utils.aoa_to_sheet(data);

            // Add worksheet to workbook
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');

            // Generate and download Excel file
            XLSX.writeFile(wb, filename);
        }

        const ftcEventsEncryptedUsername = "38rT4f0F8NuWxnWuy+y5jVjl9DnhE5RGu2gBkJfiAHTqusg8voIoKtkF6IJsUdJAWCva/4k6aQzS"
        const ftcEventsEncryptedAuthorizationKey = "rPDfh3qS+lRYAYV3n1EypXEGfZiYWWTw58nDh7Yiw71MExyJjhMEYbtt0yxK1C4nlHrlMhNyQnf6lZkhK/I5+y3R7n2dZ0bnj4P0iGIJEdc="


        async function validatePasswordAndCreateApiKeys(givenPassword) {
            if (arraysEqual(await SHA_256(givenPassword), passwordHash)) {
                if (firebaseApp == null || database == null) {
                    firebaseConfig.apiKey = await decryptApiKey(givenPassword, firebaseEncryptedApiKey)
                    firebaseApp = initializeApp(firebaseConfig)
                    database = getDatabase(firebaseApp)
                }
                ftcApiKey = await getFtcEventsApiKey(givenPassword)
                ftcApiCountriesToEvents = await getCountryEventMapFromFtcApi()
                await initTeamNameAutocompleteAndDependencies()
                return true
            }
            else {
                alert("Bad Password!")
                location.href = "/index.html"
                return false
            }
        }

        function getPassword() {
            if ("password" in params) {
                return params["password"]
            }
            else {
                let inputtedPasswordHere = prompt("Please enter the password: ")
                if (inputtedPasswordHere != null && inputtedPasswordHere != "") {
                    return inputtedPasswordHere
                }
            }
        }

        async function getFtcEventsApiKey(givenPassword) {
            const ftcEventsUsername = await decryptApiKey(givenPassword, ftcEventsEncryptedUsername)
            const ftcEventsAuthorizationKey = await decryptApiKey(givenPassword, ftcEventsEncryptedAuthorizationKey)
            return btoa(ftcEventsUsername + ":" + ftcEventsAuthorizationKey)
        }

        async function getCountryEventMapFromFtcApi() {
            let outputMap = new Map()

            let url = `https://ftc-api-proxy.fird-ftc.workers.dev/api/v2.0/${get_year()}/events`;

            if (!ftcApiKey) {
                await validatePasswordAndCreateApiKeys(inputtedPassword)
            }

            let headers = {
                "Authorization": `Basic ${ftcApiKey}`,
                "accept": "application/json"
            }

            try {
                const response = await fetch(url, {
                    // method: 'GET',
                    // headers: headers,
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                let eventsList = data["events"]
                for (let i = 0; i < eventsList.length; i++) {
                    if (!outputMap.has(eventsList[i]["country"])) {
                        outputMap.set(eventsList[i]["country"], [[eventsList[i]["code"], eventsList[i]["name"]]])
                    }
                    else {
                        outputMap.get(eventsList[i]["country"]).push([eventsList[i]["code"], eventsList[i]["name"]])
                    }
                }

                // add non-official events here
                outputMap.get("Israel").push(["ISRESC", "ESC | Preseason"])

                return outputMap
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        async function getTeamsInEventInPageData(eventCode, pageNumber) {
            let url = `https://ftc-api-proxy.fird-ftc.workers.dev/api/v2.0/${get_year()}/teams?eventCode=${eventCode}&page=${pageNumber}`;

            if (!ftcApiKey) {
                await validatePasswordAndCreateApiKeys(inputtedPassword)
            }

            let headers = {
                "Authorization": `Basic ${ftcApiKey}`,
                "accept": "application/json"
            }

            try {
                const response = await fetch(url, {
                    // method: 'GET',
                    // headers: headers,
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                return data
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }

        async function processTeamsListIntoNames(data) {
            let outputList = []
            data["teams"].forEach((value) => {
                outputList.push(`${value["nameShort"]} ${value["displayTeamNumber"]}`);
            });
            return outputList;
        }

        async function getAllTeamsInEvent(eventCode) {
            if (eventCode === "ISRESC") {
                return [
                    "Black Tigers 11192",
                    "TATOOINE 12201",
                    "BTJ 13452",
                    "RoboTen 15298",
                    "Fata Morgana 15637",
                    "SciFighters 16473",
                    "RinGoStar 18735",
                    "Everglow 19000",
                    "Build for Change 20669",
                    "Fireflies 21656",
                    "Mitzpe Yam 22646",
                    "Flying Fox 22947",
                    "Barnyard 22993",
                    "Shamir 23422",
                    "Skeleton Army 23644",
                    "RoboEagle 25041",
                    "M&M 28428",
                    "GreenBlitz 30368",
                    "Makers Assemble 32480",
                ]
            }
            let firstPageData = await getTeamsInEventInPageData(eventCode, 1);
            let allTeamsInEventNames = await processTeamsListIntoNames(firstPageData);
            let totalPageCount = firstPageData["pageTotal"];
            for (var i = 2; i <= totalPageCount; i++) {
                allTeamsInEventNames = allTeamsInEventNames.concat(await processTeamsListIntoNames(await getTeamsInEventInPageData(eventCode, i)));
            }
            return allTeamsInEventNames;
        }

        var teamNameAutocompleteAndDependenciesInitiated = false
        async function initTeamNameAutocompleteAndDependencies() {
            if (!teamNameAutocompleteAndDependenciesInitiated) {
                // init country list dropdown
                let countryListDropdown = document.getElementById("countrySelectorDropdown");
                countryListDropdown.replaceChildren()
    
                
                ftcApiCountriesToEvents.forEach((value, key) => {
                    const newOption = document.createElement('option');
                    newOption.value = key;
                    newOption.text = key;
                    countryListDropdown.appendChild(newOption);
                })
                
    
                // init events dropdown
                countryListDropdown.addEventListener("change", function(event) {
                    pushEventsToEventsDropdown(event.target.value);
                });
    
                await pushEventsToEventsDropdown(countryListDropdown.value)
    
    
                //init autocomplete team names datalist
                let eventListDropdown = document.getElementById("eventSelectorDropdown");
    
                eventListDropdown.addEventListener("change", function(event) {
                    updateTeamsNamesList(event.target.value);
                });
    
                await updateTeamsNamesList(eventListDropdown.value)
    
                teamNameAutocompleteAndDependenciesInitiated = true
            }
        }

        async function pushEventsToEventsDropdown(selectedCountry) {
            let eventListDropdown = document.getElementById("eventSelectorDropdown");

            eventListDropdown.replaceChildren()

            let eventCodeAndNameList = ftcApiCountriesToEvents.get(selectedCountry);

            await eventCodeAndNameList.sort((a, b) => a[1].localeCompare(b[1]))

            await eventCodeAndNameList.forEach((value) => {
                const newOption = document.createElement('option');
                newOption.value = value[0];
                newOption.text = value[1];
                eventListDropdown.appendChild(newOption);
            });

            await updateTeamsNamesList(eventListDropdown.value)
        }

        async function updateTeamsNamesList(selectedEventCode) {
            currentEventsTeamsNamesList = await getAllTeamsInEvent(selectedEventCode)

            let teamNameAutocompleteDatalist = document.getElementById("teamNameSuggestions")

            teamNameAutocompleteDatalist.replaceChildren();

            currentEventsTeamsNamesList.forEach((teamName) => {
                const newOption = document.createElement('option');
                newOption.value = teamName;
                teamNameAutocompleteDatalist.appendChild(newOption);
            });
        }
        
        const inputtedPassword = getPassword()

        if (await validatePasswordAndCreateApiKeys(inputtedPassword)) {
            populate_year_range_select()

            sendButton.addEventListener('click', async () => {
                if (await validatePasswordAndCreateApiKeys(inputtedPassword)) {
                    write_to_firebase()
                }
            })

            downloadButton.addEventListener('click', async () => {
                if (await validatePasswordAndCreateApiKeys(inputtedPassword)) {
                    var year_range = yearRangeSelect.value
                    fetch_from_firebase(year_range).then(data => {
                        downloadExcelFromArray(data, "scouting_data_" + year_range + ".xlsx")
                    })
                }
            })
        }


        initializeModules()
    </script>

    <script>
        let counters = new Map([
            ["autonomous", new Map()],
            ["opMode", new Map()]
        ])

        let autonomousCounterModules = ["Classified Artifacts", "Overflow Artifacts", "Artifacts Matching Pattern"]
        let opModeCounterModules = ["Classified Artifacts", "Overflow Artifacts", "Depot Artifacts", "Artifacts Matching Pattern"]

        const everythingScoreStringProcessor = function(score) {
            return `Score: ${score}p`
        }

        
        const classifiedArtifactsScoreCalculator = (count) => 3*count
        const overflowAndDepotArtifactsScoreCalculator = (count) => 1*count
        const artifactsMatchingPatternScoreCalculator = (count) => 2*count
        const didLeaveScoreCalculator = function(value) {
            if (value) {
                return 3
            }
            else {
                return 0
            }
        }
        const baseReturnScoreCalculator = function(value) {
            if (value == "None") {
                return 0
            }
            else if (value == "Partial") {
                return 5
            }
            else if (value == "Full") {
                return 10
            }
            else if (value == "Bonus") {
                return 20
            }
            return 0
        }
        
        let calculators = new Map([
            ["autonomous", new Map([
                ["classified-artifacts", classifiedArtifactsScoreCalculator],
                ["overflow-artifacts", overflowAndDepotArtifactsScoreCalculator],
                ["artifacts-matching-pattern", artifactsMatchingPatternScoreCalculator],
                ["did-leave", didLeaveScoreCalculator],
            ])],
            ["opMode", new Map([
                ["classified-artifacts", classifiedArtifactsScoreCalculator],
                ["overflow-artifacts", overflowAndDepotArtifactsScoreCalculator],
                ["depot-artifacts", overflowAndDepotArtifactsScoreCalculator],
                ["artifacts-matching-pattern", artifactsMatchingPatternScoreCalculator],
                ["base-return", baseReturnScoreCalculator],
            ])]
        ])

        let baseReturnRadioButtons

        let didLeaveCheckbox

        var totalScoreDisplay = document.getElementById("total-score-display")
        const totalScoreStringProcessor = (score) => `Total Score: ${score}p`
        
        function initializeModules() {
            const autonomousModulesContainer = document.getElementById("autonomousModulesContainer")
            const opModeModulesContainer = document.getElementById("opModeModulesContainer")

            for (var opModeStat in opModeCounterModules) {
                counters.get("opMode").set(opModeCounterModules[opModeStat], 0)
            }
            for (var autonomousStat in autonomousCounterModules) {
                counters.get("autonomous").set(autonomousCounterModules[autonomousStat], 0)
            }
            counters.get("opMode").set("Base Return", "None")
            counters.get("autonomous").set("Did Leave", false)

            opModeModulesContainer.innerHTML = opModeCounterModules.map(title => `
                    <div class="module counter" id="counter-module-opMode-${sanitizeId(title)}">
                        <div class="module-title">${title}</div>
                        <div class="score-display" id="score-display-opMode-${(sanitizeId(title))}"">Score: 0p</div>
                        <div class="counter-display" id="counter-opMode-${sanitizeId(title)}">0</div>
                        <div class="counter-buttons">
                            <button class="counter-btn minus" onclick="updateCounter('opMode-${title}', -1, everythingScoreStringProcessor)">−</button>
                            <button class="counter-btn plus" onclick="updateCounter('opMode-${title}', 1, everythingScoreStringProcessor)">+</button>
                        </div>
                    </div>
                `).join("") + `
                    <div class="module radio" id="radio-module-opMode-base-return">
                        <div class="module-title">Base Return</div>
                        <input type="radio" name="opmode-base-return" value="None" id="none-return" checked>
                        <label for="none-return">None (0p)</label><br>

                        <input type="radio" name="opmode-base-return" value="Partial" id="partial-return">
                        <label for="partial-return">Partial (5p)</label><br>

                        <input type="radio" name="opmode-base-return" value="Full" id="full-return">
                        <label for="full-return">Full (10p)</label><br>

                        <input type="radio" name="opmode-base-return" value="Bonus" id="bonus-return">
                        <label for="bonus-return">Bonus (10p+10p)</label><br>
                    </div>
                `

            autonomousModulesContainer.innerHTML = autonomousCounterModules.map(title => `
                    <div class="module counter" id="counter-module-autonomous-${sanitizeId(title)}">
                        <div class="module-title">${title}</div>
                        <div class="score-display" id="score-display-autonomous-${(sanitizeId(title))}"">Score: 0p</div>
                        <div class="counter-display" id="counter-autonomous-${sanitizeId(title)}">0</div>
                        <div class="counter-buttons">
                            <button class="counter-btn minus" onclick="updateCounter('autonomous-${title}', -1, everythingScoreStringProcessor)">−</button>
                            <button class="counter-btn plus" onclick="updateCounter('autonomous-${title}', 1, everythingScoreStringProcessor)">+</button>
                        </div>
                    </div>
                `).join("") + `
                        <div class="module switch" id="switch-module-autonomous-did-leave">
                            <input type="checkbox" id="switch-autonomous-did-leave"/>
                            <span class="slider">Did Do Leave? (3p)</span>
                        </div>
                `

            baseReturnRadioButtons = document.querySelectorAll('input[name="opmode-base-return"]');
            baseReturnRadioButtons.forEach(
                radioButton => {
                    radioButton.addEventListener(
                        'change', 
                        function() {
                            if (this.checked) {
                                counters.get("opMode").set("Base Return", this.value)
                                updateTotalScoreDisplay()
                            }
                        }
                    )
                }
            )

            didLeaveCheckbox = document.getElementById("switch-autonomous-did-leave")
            didLeaveCheckbox.addEventListener('change', function() {
                counters.get("autonomous").set("Did Leave", this.checked)
                updateTotalScoreDisplay()
            })

        }



        function updateTotalScoreDisplay() {
            let totalScore = 0

            counters.forEach(
                (innerMap, autonomousOrOpMode) => {
                    innerMap.forEach(
                        (value, key) => {
                            totalScore += calculators.get(autonomousOrOpMode).get(sanitizeId(key))(value)
                        }
                    )
                }
            );

            if (totalScoreDisplay == null) {
                totalScoreDisplay = document.getElementById("total-score-display")
            }

            totalScoreDisplay.textContent = totalScoreStringProcessor(totalScore)
        }

        function sanitizeId(title) {
            return title.replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
        }

        function updateCounter(nameToUpdate, change, scoreStringProcessor) {
            const prefix = nameToUpdate.substring(0, nameToUpdate.indexOf("-"))
            const title = nameToUpdate.substring(nameToUpdate.indexOf("-") + 1)
            const currentValue = counters.get(prefix).get(title) || 0;
            const newValue = Math.max(0, currentValue + change); // Prevent negative values
            counters.get(prefix).set(title, newValue);

            const counterElement = document.getElementById(`counter-${prefix}-${sanitizeId(title)}`)
            counterElement.textContent = newValue

            const scoreDisplayElement = document.getElementById(`score-display-${prefix}-${sanitizeId(title)}`)
            scoreDisplayElement.textContent = scoreStringProcessor(calculators.get(prefix).get(sanitizeId(title))(newValue))

            updateTotalScoreDisplay()
        }
    </script>


    <select id="yearRangeSelect"></select><br>
    <button id="downloadScoutingDataButton">Download Data</button><br><br>
    <label for="usernameInput">Enter your name:</label><br>
    <input type="text" id="usernameInput" name="usernameInputName"><br>
    <label for="countrySelectorDropdown">Choose country of the event:</label><br>
    <select id="countrySelectorDropdown" name="countrySelectorDropdownName">
    </select><br>
    <label for="eventSelectorDropdown">Choose name of event:</label><br>
    <select id="eventSelectorDropdown" name="eventSelectorDropdownName">
    </select><br>
    <label for="teamNameInput">Enter team name:</label><br>
    <input type="text" id="teamNameInput" name="teamNameInputName" list="teamNameSuggestions"><br>
    <datalist id="teamNameSuggestions"></datalist>
    <div class="inline-row">
        <button id="sendButton">Send Scouting Data</button>
        <p style="color: greenyellow; font-size: 24px;" id="scoutingDataSendSuccessIndicator" hidden>Data successfully sent!</p>
    </div>
    <p id="total-score-display" class="total-score-display">Total Score: 0p</p>
    <label for="notesInput">Do you have any notes on the team?</label><br>
    <input type="text" id="notesInput" name="notesInputName"><br>
    <h1>Autonomous</h1><br>
    <div class="modules-container" id="autonomousModulesContainer"></div><br><br>
    <h1>OpMode</h1><br>
    <div class="modules-container" id="opModeModulesContainer"></div>
</body>

</html>